# MTConnect SmartSaw Platform

A comprehensive solution for connecting industrial saws to the MTConnect standard for real-time monitoring, data collection, and advanced control capabilities.

## What is MTConnect?

MTConnect is an open, royalty-free manufacturing communications protocol designed to facilitate data exchange between machine tools and software applications. It provides a common vocabulary with standardized definitions for the meaning of data generated by manufacturing equipment, making the data interpretable by various software applications.

This standardized approach enables:
- Real-time machine monitoring and data collection
- Integration with analytics and business systems
- Improved operational visibility and decision-making
- Enhanced productivity and reduced downtime

## System Architecture

The SmartSaw MTConnect system consists of the following containerized components:

- **MTConnect Agent**: Central component that receives and processes data from the adapter and serves it to client applications using the MTConnect protocol
- **HEMsaw Adapter**: Interfaces with the saw control system to collect real-time operational data
- **ODS (Object Database System)**: Manages data storage and retrieval for parts, materials, and operational metrics
- **DEVCTL (Device Control Platform)**: Enables remote programming of materials and jobs
- **MQTT Broker**: Manages message queuing and communication between system components
- **MongoDB**: Stores parts, jobs, material data, and historical information
- **Watchtower**: Automatically updates Docker containers with the latest available images

All components are containerized using Docker and orchestrated with Docker Compose for simplified deployment and management.

## Supported SmartSaw Models

### DC Series
- H130 (508mm x 508mm x 3048mm)
- DC22 (572mm x 572mm x 3048mm)
- DC26 (660mm x 660mm x 3048mm)
- DC30 (762mm x 762mm x 3048mm)

### WF Series
- WF1827 (457mm x 686mm x 3048mm)
- WF160 (635mm x 762mm x 3048mm)
- WF190 (635mm x 1172mm x 3048mm)

Each model is available in both standard and SCT (Smart Cut Technology) variants.

## Key Features

- **Real-time Monitoring**: Track machine status, operational parameters, and performance metrics
- **Servo Control**: Precise control of saw head (X-axis) and feed (Z-axis) movements
- **Band Motor Monitoring**: Track band motor performance and health
- **Door State Monitoring**: Monitor drive and idle door states for safety and operational insights
- **Performance Tracking**: Monitor cut time and CPU on time for productivity analysis
- **Material Handling**: Advanced material handling capabilities integrated with the control system
- **Smart Cut Technology (SCT)**: Available on all models for optimized cutting performance
- **Containerized Deployment**: All components run in Docker containers for easy installation and updates

## Installation and Management

### Initial Installation

To get the system working on the IPC (Industrial PC) for the first time, clone the GitHub repository:

```bash
git clone --recurse-submodules --progress --depth 1 https://github.com/HEM-Inc/MTConnect_SmartSaw.git mtconnect
```

After cloning the repository, run the installation script to place files in the correct locations:

```bash
sudo bash ssInstall.sh
```

### Updating an Existing Installation

If the agent has already been loaded, use the update script to update the files and restart the service:

```bash
sudo bash ssUpgrade.sh
```

### Configuration

Edit the `env.sh` file to set the default installation file names for your specific installation, or run the `ssInstall.sh`/`ssUpgrade.sh` script with the appropriate options. The chosen files will be defined in the `env.sh` file, allowing for persistence of these settings across all updates and installs on that machine.

### Management Scripts

The system includes several management scripts for installation, updates, and maintenance:

#### ssInstall.sh

Installs the MTConnect components, including the Agent, Adapter, ODS, MQTT Broker, and MongoDB.

```bash
Syntax: ssInstall.sh [-h|-a File_Name|-j File_Name|-d File_Name|-c File_Name|-u Serial_number|-f]

options:
-a File_Name          Declare the afg file name; Defaults to - SmartSaw_DC_HA.afg
-j File_Name          Declare the JSON file name; Defaults to - SmartSaw_alarms.json
-d File_Name          Declare the MTConnect agent device file name; Defaults to - SmartSaw_DC_HA.xml
-c File_Name          Declare the Device control config file name; Defaults to - devctl_json_config.json
-u Serial_number      Declare the serial number for the uuid; Defaults to - SmartSaw
-b                    Use the MQTT bridge configuration file name; Defaults to - mosq_bridge.conf
-f                    Force install of the files
-h                    Print this Help.
```

#### ssUpgrade.sh

Upgrades existing components and restarts services.

```bash
Syntax: ssUpgrade.sh [-A|-a File_Name|-j File_Name|-d File_Name|-c File_Name|-u Serial_number|-b|-m|-i|-h]

options:
-A                Update the MTConnect Agent, HEMsaw adapter, ODS, MQTT, and Mongodb application
-a File_Name      Declare the afg file name; Defaults to - SmartSaw_DC_HA.afg
-j File_Name      Declare the JSON file name; Defaults to - SmartSaw_alarms.json
-d File_Name      Declare the MTConnect agent device file name; Defaults to - SmartSaw_DC_HA.xml
-c File_Name      Declare the Device control config file name; Defaults to - devctl_json_config.json
-u Serial_number  Declare the serial number for the uuid; Defaults to - SmartSaw
-b                Update the MQTT broker to use the bridge configuration; runs - mosq_bridge.conf
-m                Update the MongoDB database with default materials
-i                ReInit the MongoDB parts and job databases
-h                Print this Help.
```

#### ssClean.sh

Removes installed components and cleans up the system.

```bash
Syntax: ssClean.sh [-A|-H|-a|-M|-O|-C|-S|-d|-D|-L|-h]

options:
-A                    Uninstall ALL
-H                    Uninstall the HEMsaw adapter application
-a                    Uninstall the MTConnect Agent application
-M                    Uninstall the MQTT Broker application
-O                    Uninstall the HEMsaw ods application
-C                    Uninstall the HEMsaw devctl application
-S                    Uninstall the HEMSaw MongoDB application
-d                    Disable mongod, ods, and agent daemons
-D                    Uninstall Docker
-L Container_Name     Log repair for any NULL or ^@ char
-h                    Print this Help.
```

#### ssStatus.sh

Checks the status of all system components.

## System Components Details

### MTConnect Agent

The MTConnect Agent serves as the central component of the system, receiving data from the adapter and serving it to client applications in the MTConnect standard format. It handles data translation, buffering, and protocol compliance.

### HEMsaw Adapter

The adapter interfaces directly with the saw control system, collecting real-time operational data and translating it into a format usable by the MTConnect Agent. It monitors various parameters such as axis positions, motor status, door states, and operational modes.

### ODS (Object Database System)

The ODS manages data storage and retrieval for parts, materials, and operational metrics. It provides a structured way to store and access this information for analysis and reporting.

### DEVCTL (Device Control Platform)

The Device Control Platform enables remote programming of materials and jobs. It provides an interface for defining, scheduling, and managing cutting operations.

### MQTT Broker

The MQTT Broker manages message queuing and communication between system components. It enables flexible, efficient, and reliable message passing within the system.

### MongoDB

MongoDB serves as the database backend for the system, storing parts, jobs, material data, and historical information. It provides a flexible and scalable way to manage this data.

## Troubleshooting

- If components don't start properly, check the logs with `docker-compose logs [service_name]`
- Use the ssStatus.sh script to check the status of all components
- Ensure proper permissions on configuration files and directories
- Verify network connectivity between components

## Support

For support, please contact HEM Inc. technical support or visit our website for documentation and resources.

## License

This project is released under the license included in the LICENSE file.
